<html> 
    <head> 
        <meta name="viewport" content="initial-scale=1.0, user-scalable=no" /> 
        <meta http-equiv="content-type" content="text/html; charset=UTF-8"/> 
        <title>dCache installations around the world</title> 
        <link href="http://code.google.com/apis/maps/documentation/javascript/examples/default.css" rel="stylesheet" type="text/css" /> 
        <script type="text/javascript" src="http://maps.google.com/maps/api/js?sensor=false"></script> 
        <script type="text/javascript" src="dcache-map.data"></script> 
        <script type="text/javascript"> 
            function initialize() {

                // Create the map 
                // No need to specify zoom and center as we fit the map further down.
                var map = new google.maps.Map(document.getElementById("map_canvas"), {
                    mapTypeId: google.maps.MapTypeId.ROADMAP,
                    streetViewControl: false
                });
 
                // Create the shared infowindow with two DIV placeholders
                // One for a text string, the other for the StreetView panorama.
                var content = document.createElement("DIV");
                var title = document.createElement("DIV");
                content.appendChild(title);

                function sizeToString(s) {
                    var n = parseInt(s)
                    bytes = n*Math.pow(1024,3);
                    var sizes = ['n/a', 'bytes', 'KiB', 'MiB', 'GiB', 'TiB', 'PiB', 'EiB', 'ZiB', 'YiB'];
                    if (bytes == 0) {
                        return '0 bytes';
                    }
                    var i = +Math.floor(Math.log(bytes) / Math.log(1024));
                    return  (bytes / Math.pow(1024, i)).toFixed(i ? 1 : 0) + ' ' + sizes[ isNaN(bytes) ? 0 : i + 1 ];
                }

                function genInfo(data) {
                    return '<h3>'+ data.desc +'</h3>' +
                        '<table border="0" cellspacing="2" cellpadding="2">' +
                        ' <colgroup>' +
                        '  <col width="130">' +
                        '  <col width="350">' +
                        ' </colgroup>' +
                        '  <tr><td><b>Location:</b></td><td>' + data.loc + '</td></tr>' +
                        '  <tr><td><b>Site URL:</b></td><td><a href=' + data.url + '>' + data.url + '</a></td></tr>' +
                        '  <tr><td><b>End Point:</b></td><td>' + data.name + '</td></tr>' +
                        '  <tr><td><b>Version:</b></td><td>' + data.version + '</td></tr>' +
                        '  <tr><td><b>Total Size:</b></td><td>' + sizeToString(data.size) + '</td></tr>' +
                        '  <tr><td><b>Used Size:</b></td><td>' + sizeToString(data.used) + '</td></tr>' +
                        '</table>';
                }
                // Define the list of markers.
                // taken from dcache-map.data

                var infoWindow = new google.maps.InfoWindow;

                // Create the markers
                for (index in markers) addMarker(markers[index]);
                function addMarker(data) {
                    var marker = new google.maps.Marker({
                        position: new google.maps.LatLng(data.lat, data.lng),
                        map: map,
                        title: data.desc
                    });

                    google.maps.event.addListener(marker, 'click', function() {
                        infoWindow.setContent(genInfo(data));
                        infoWindow.open(map, marker);
                    });

                }

                // Zoom and center the map to fit the markers
                // This logic could be conbined with the marker creation.
                // Just keeping it separate for code clarity.
                var bounds = new google.maps.LatLngBounds();
                for (index in markers) {
                    var data = markers[index];
                    bounds.extend(new google.maps.LatLng(data.lat, data.lng));
                }
                map.fitBounds(bounds);
                google.maps.event.addListener(map, 'click', function() {
                    infoWindow.close();
                });
            }
        </script> 
    </head> 
    <body onload="initialize()"> 
        <div id="map_canvas"></div> 
    </body> 
</html>
